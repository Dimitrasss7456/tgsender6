<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ - Telegram Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">
    <div class="container-fluid">
        <div class="row">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="col-md-3 bg-secondary p-3">
                <h3 class="text-center mb-4">
                    <i class="fas fa-user-cog"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏
                </h3>

                <!-- –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ -->
                <div class="card bg-dark mb-3">
                    <div class="card-header">
                        <h5><i class="fas fa-magic"></i> –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary w-100" onclick="autoAssignGenders()">
                            <i class="fas fa-magic"></i> –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
                        </button>
                    </div>
                </div>

                <!-- –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                <div class="card bg-dark mb-3">
                    <div class="card-header">
                        <h5><i class="fas fa-comments"></i> –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h5>
                    </div>
                    <div class="card-body">
                        <form id="commentForm" onsubmit="return false;">
                            <div class="mb-3">
                                <label for="commentPost" class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç</label>
                                <input type="url" class="form-control" id="commentPost"
                                       placeholder="https://t.me/channel/123" required>
                            </div>

                            <div class="mb-3">
                                <label for="maleComments" class="form-label">–ú—É–∂—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É)</label>
                                <textarea class="form-control" id="maleComments" rows="5"
                                          placeholder="–û—Ç–ª–∏—á–Ω—ã–π –ø–æ—Å—Ç!&#10;–°–æ–≥–ª–∞—Å–µ–Ω&#10;–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ"></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="femaleComments" class="form-label">–ñ–µ–Ω—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É)</label>
                                <textarea class="form-control" id="femaleComments" rows="5"
                                          placeholder="–û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è!&#10;–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ—Å—Ç&#10;–û—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ"></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="commentDelay" class="form-label">–ó–∞–¥–µ—Ä–∂–∫–∞ (—Å–µ–∫—É–Ω–¥—ã)</label>
                                <input type="number" class="form-control" id="commentDelay" value="60" min="10">
                            </div>

                            <button type="button" class="btn btn-success w-100" onclick="startCommentCampaign()">
                                <i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                            </button>
                        </form>
                    </div>
                </div>

                <!-- –†–µ–∞–∫—Ü–∏–∏ -->
                <div class="card bg-dark mb-3">
                    <div class="card-header">
                        <h5><i class="fas fa-heart"></i> –†–µ–∞–∫—Ü–∏–∏</h5>
                    </div>
                    <div class="card-body">
                        <form id="reactionForm" onsubmit="return false;">
                            <div class="mb-3">
                                <label for="reactionPost" class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç</label>
                                <input type="url" class="form-control" id="reactionPost"
                                       placeholder="https://t.me/channel/123" required>
                            </div>

                            <div class="mb-3">
                                <label for="reactionEmoji" class="form-label">–†–µ–∞–∫—Ü–∏—è</label>
                                <select class="form-control" id="reactionEmoji">
                                    <option value="üëç">üëç –ù—Ä–∞–≤–∏—Ç—Å—è</option>
                                    <option value="‚ù§Ô∏è">‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ</option>
                                    <option value="üòÇ">üòÇ –°–º–µ—à–Ω–æ</option>
                                    <option value="üòÆ">üòÆ –£–¥–∏–≤–ª–µ–Ω–∏–µ</option>
                                    <option value="üò¢">üò¢ –ì—Ä—É—Å—Ç—å</option>
                                    <option value="üî•">üî• –û–≥–æ–Ω—å</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="reactionDelay" class="form-label">–ó–∞–¥–µ—Ä–∂–∫–∞ (—Å–µ–∫—É–Ω–¥—ã)</label>
                                <input type="number" class="form-control" id="reactionDelay" value="30" min="5">
                            </div>

                            <button type="button" class="btn btn-warning w-100" onclick="startReactionCampaign()">
                                <i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–µ–∞–∫—Ü–∏–∏
                            </button>
                        </form>
                    </div>
                </div>

                <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä—ã -->
                <div class="card bg-dark mb-3">
                    <div class="card-header">
                        <h5><i class="fas fa-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä—ã</h5>
                    </div>
                    <div class="card-body">
                        <form id="viewForm" onsubmit="return false;">
                            <div class="mb-3">
                                <label for="viewPost" class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç</label>
                                <input type="url" class="form-control" id="viewPost"
                                       placeholder="https://t.me/channel/123" required>
                            </div>

                            <div class="mb-3">
                                <label for="viewDelay" class="form-label">–ó–∞–¥–µ—Ä–∂–∫–∞ (—Å–µ–∫—É–Ω–¥—ã)</label>
                                <input type="number" class="form-control" id="viewDelay" value="15" min="5">
                            </div>

                            <button type="button" class="btn btn-info w-100" onclick="startViewCampaign()">
                                <i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="col-md-9 p-4">
                <h2><i class="fas fa-users"></i> –ê–∫–∫–∞—É–Ω—Ç—ã</h2>

                <div id="alerts"></div>

                <div class="row">
                    {% for account in accounts %}
                    <div class="col-xl-4 col-lg-6 mb-4">
                        <div class="card bg-secondary" id="account-{{ account.id }}">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span class="badge bg-{{ 'success' if account.is_active else 'danger' }}">
                                    {{ account.phone }}
                                </span>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary btn-sm"
                                            onclick="updateTelegramProfile({{ account.id }})"
                                            title="–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤ Telegram">
                                        <i class="fas fa-sync"></i>
                                    </button>
                                    <button class="btn btn-outline-success btn-sm"
                                            onclick="showEditProfileModal({{ account.id }})"
                                            title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-2">
                                            <label class="form-label small">–ò–º—è</label>
                                            <input type="text" class="form-control form-control-sm" id="first_name_{{ account.id }}"
                                                   value="{{ account.first_name or '' }}"
                                                   onchange="updateField({{ account.id }}, 'first_name', this.value)">
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label small">–§–∞–º–∏–ª–∏—è</label>
                                            <input type="text" class="form-control form-control-sm" id="last_name_{{ account.id }}"
                                                   value="{{ account.last_name or '' }}"
                                                   onchange="updateField({{ account.id }}, 'last_name', this.value)">
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label small">–ì–µ–Ω–¥–µ—Ä</label>
                                            <select class="form-control form-control-sm" id="gender_{{ account.id }}"
                                                    onchange="updateField({{ account.id }}, 'gender', this.value)">
                                                <option value="">–ù–µ —É–∫–∞–∑–∞–Ω</option>
                                                <option value="male" {{ 'selected' if account.gender == 'male' else '' }}>–ú—É–∂—Å–∫–æ–π</option>
                                                <option value="female" {{ 'selected' if account.gender == 'female' else '' }}>–ñ–µ–Ω—Å–∫–∏–π</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="mb-2">
                                            <label class="form-label small">–û —Å–µ–±–µ</label>
                                            <textarea class="form-control form-control-sm" rows="3" id="bio_{{ account.id }}"
                                                      onchange="updateField({{ account.id }}, 'bio', this.value)"
                                                      placeholder="–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ–±–µ">{{ account.bio or '' }}</textarea>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label small">–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è</label>
                                            <input type="file" class="form-control form-control-sm"
                                                   accept="image/*"
                                                   onchange="uploadProfilePhoto({{ account.id }}, this)">
                                        </div>
                                    </div>
                                </div>

                                <div class="text-muted small mt-2">
                                    <div>–°—Ç–∞—Ç—É—Å: <span class="badge bg-{{ 'success' if account.status == 'online' else 'secondary' }}">{{ account.status }}</span></div>
                                    <div>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: {{ account.last_activity.strftime('%d.%m.%Y %H:%M') if account.last_activity else '–ù–∏–∫–æ–≥–¥–∞' }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProfileModalLabel">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editProfileForm">
                        <input type="hidden" id="edit-account-id">
                        <div class="mb-3">
                            <label for="edit-first-name" class="form-label">–ò–º—è</label>
                            <input type="text" class="form-control" id="edit-first-name">
                        </div>
                        <div class="mb-3">
                            <label for="edit-last-name" class="form-label">–§–∞–º–∏–ª–∏—è</label>
                            <input type="text" class="form-control" id="edit-last-name">
                        </div>
                        <div class="mb-3">
                            <label for="edit-bio" class="form-label">–û —Å–µ–±–µ</label>
                            <textarea class="form-control" id="edit-bio" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="edit-gender" class="form-label">–ì–µ–Ω–¥–µ—Ä</label>
                            <select class="form-control" id="edit-gender">
                                <option value="">–ù–µ —É–∫–∞–∑–∞–Ω</option>
                                <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                                <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="saveEditedProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showAlert(message, type) {
            const alertsContainer = document.getElementById('alerts');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertsContainer.appendChild(alertDiv);

            setTimeout(() => {
                if(alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞
        function editAccountProfile(accountId) {
            const accountCard = document.getElementById(`account-${accountId}`);
            if (!accountCard) return;

            const firstNameInput = accountCard.querySelector('input[id*="first_name"]');
            const lastNameInput = accountCard.querySelector('input[id*="last_name"]');
            const bioTextarea = accountCard.querySelector('textarea[id*="bio"]');
            const genderSelect = accountCard.querySelector('select[id*="gender"]');

            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            showEditProfileModal(accountId);
        }


        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞
        function updateField(accountId, field, value) {
            fetch(`/api/accounts/${accountId}/profile`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({[field]: value})
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // showAlert('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω', 'success'); // –°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ –≤ saveEditedProfile
                } else {
                    showAlert(data.message || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'danger');
                }
            })
            .catch(error => {
                showAlert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'danger');
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –≤ Telegram
        async function updateTelegramProfile(accountId) {
            try {
                const button = document.querySelector(`#account-${accountId} .btn-group .btn-outline-primary`);
                if (button) {
                    button.disabled = true;
                    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –û–±–Ω–æ–≤–ª—è—é...';
                }

                const response = await fetch(`/api/accounts/${accountId}/update_telegram_profile`, {
                    method: 'POST'
                });

                const result = await response.json();

                if (button) {
                    button.disabled = false;
                    button.innerHTML = '<i class="fas fa-sync"></i>';
                }

                if (result.success) {
                    showAlert('–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω –≤ Telegram!', 'success');
                } else {
                    showAlert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: ' + result.message, 'danger');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showAlert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –≤ Telegram', 'danger');

                const button = document.querySelector(`#account-${accountId} .btn-group .btn-outline-primary`);
                if (button) {
                    button.disabled = false;
                    button.innerHTML = '<i class="fas fa-sync"></i>';
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
        function showEditProfileModal(accountId) {
            fetch(`/api/accounts/${accountId}`)
                .then(response => response.json())
                .then(account => {
                    document.getElementById('edit-account-id').value = accountId;
                    document.getElementById('edit-first-name').value = account.first_name || '';
                    document.getElementById('edit-last-name').value = account.last_name || '';
                    document.getElementById('edit-bio').value = account.bio || '';
                    document.getElementById('edit-gender').value = account.gender || '';

                    const modal = new bootstrap.Modal(document.getElementById('editProfileModal'));
                    modal.show();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–∞:', error);
                    showAlert('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–∞', 'danger');
                });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è
        async function uploadProfilePhoto(accountId, input) {
            if (!input.files || !input.files[0]) return;

            const formData = new FormData();
            formData.append('photo', input.files[0]);

            try {
                const response = await fetch(`/api/accounts/${accountId}/upload_photo`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    showAlert('–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!', 'success');
                } else {
                    showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ: ' + result.message, 'danger');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ', 'danger');
            }
        }

        // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≥–µ–Ω–¥–µ—Ä–æ–≤
        async function autoAssignGenders() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ...';

            try {
                const response = await fetch('/api/accounts/auto_assign_genders', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });

                const data = await response.json();
                if (data.success) {
                    showAlert(data.message, 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showAlert(data.message || '–û—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≥–µ–Ω–¥–µ—Ä–æ–≤', 'danger');
                }
            } catch (error) {
                showAlert('–û—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≥–µ–Ω–¥–µ—Ä–æ–≤: ' + error.message, 'danger');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-magic"></i> –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–ø–∞–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        async function startCommentCampaign() {
            const postUrl = document.getElementById('commentPost').value;
            const maleComments = document.getElementById('maleComments').value;
            const femaleComments = document.getElementById('femaleComments').value;
            const delay = document.getElementById('commentDelay').value;

            if (!postUrl || (!maleComments && !femaleComments)) {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏', 'warning');
                return;
            }

            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–æ–∑–¥–∞–Ω–∏–µ...';

            try {
                // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –∫–∞–º–ø–∞–Ω–∏—é
                const response = await fetch('/api/comment_campaigns', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        name: `–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ${new Date().toLocaleString()}`,
                        post_url: postUrl,
                        male_comments: maleComments,
                        female_comments: femaleComments,
                        delay_seconds: parseInt(delay)
                    })
                });

                const result = await response.json();
                if (result.success) {
                    // –¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–ø–∞–Ω–∏—é
                    const startResponse = await fetch(`/api/comment_campaigns/${result.campaign_id}/start`, {
                        method: 'POST'
                    });

                    const startResult = await startResponse.json();
                    if (startResult.success) {
                        showAlert('–ö–∞–º–ø–∞–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–∞!', 'success');
                        document.getElementById('commentForm').reset();
                    } else {
                        showAlert('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + startResult.message, 'danger');
                    }
                } else {
                    showAlert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–º–ø–∞–Ω–∏–∏: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('–û—à–∏–±–∫–∞: ' + error.message, 'danger');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–ø–∞–Ω–∏–∏ —Ä–µ–∞–∫—Ü–∏–π
        async function startReactionCampaign() {
            const postUrl = document.getElementById('reactionPost').value;
            const emoji = document.getElementById('reactionEmoji').value;
            const delay = document.getElementById('reactionDelay').value;

            if (!postUrl) {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç', 'warning');
                return;
            }

            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ó–∞–ø—É—Å–∫...';

            try {
                const response = await fetch('/api/reaction_campaigns', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        name: `–†–µ–∞–∫—Ü–∏–∏ ${new Date().toLocaleString()}`,
                        post_url: postUrl,
                        reaction_emoji: emoji,
                        delay_seconds: parseInt(delay)
                    })
                });

                const result = await response.json();
                if (result.success) {
                    showAlert('–ö–∞–º–ø–∞–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–π –∑–∞–ø—É—â–µ–Ω–∞!', 'success');
                    document.getElementById('reactionForm').reset();
                } else {
                    showAlert('–û—à–∏–±–∫–∞: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–ø–∞–Ω–∏–∏: ' + error.message, 'danger');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–µ–∞–∫—Ü–∏–∏';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–ø–∞–Ω–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
        async function startViewCampaign() {
            const postUrl = document.getElementById('viewPost').value;
            const delay = document.getElementById('viewDelay').value;

            if (!postUrl) {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç', 'warning');
                return;
            }

            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ó–∞–ø—É—Å–∫...';

            try {
                const response = await fetch('/api/view_campaigns', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        name: `–ü—Ä–æ—Å–º–æ—Ç—Ä—ã ${new Date().toLocaleString()}`,
                        post_url: postUrl,
                        delay_seconds: parseInt(delay)
                    })
                });

                const result = await response.json();
                if (result.success) {
                    showAlert('–ö–∞–º–ø–∞–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –∑–∞–ø—É—â–µ–Ω–∞!', 'success');
                    document.getElementById('viewForm').reset();
                } else {
                    showAlert('–û—à–∏–±–∫–∞: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–ø–∞–Ω–∏–∏: ' + error.message, 'danger');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä—ã';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        async function saveEditedProfile() {
            const accountId = document.getElementById('edit-account-id').value;
            const firstName = document.getElementById('edit-first-name').value;
            const lastName = document.getElementById('edit-last-name').value;
            const bio = document.getElementById('edit-bio').value;
            const gender = document.getElementById('edit-gender').value;

            await updateField(accountId, 'first_name', firstName);
            await updateField(accountId, 'last_name', lastName);
            await updateField(accountId, 'bio', bio);
            await updateField(accountId, 'gender', gender);

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö –∫–∞—Ä—Ç–æ—á–∫–∞—Ö
            const accountCard = document.getElementById(`account-${accountId}`);
            if (accountCard) {
                const firstNameInput = accountCard.querySelector('input[id*="first_name"]');
                const lastNameInput = accountCard.querySelector('input[id*="last_name"]');
                const bioTextarea = accountCard.querySelector('textarea[id*="bio"]');
                const genderSelect = accountCard.querySelector('select[id*="gender"]');

                if (firstNameInput) firstNameInput.value = firstName;
                if (lastNameInput) lastNameInput.value = lastName;
                if (bioTextarea) bioTextarea.value = bio;
                if (genderSelect) genderSelect.value = gender;
            }

            const modal = bootstrap.Modal.getInstance(document.getElementById('editProfileModal'));
            modal.hide();
            showAlert('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–∞–∂–∞—Ç—å "–û–±–Ω–æ–≤–∏—Ç—å –≤ Telegram".', 'info');
        }
        
        // –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è (–¥–æ–±–∞–≤–ª–µ–Ω—ã)
        function editProfile(accountId) {
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h3>
                    <form id="editProfileForm" onsubmit="submitProfileEdit(event, ${accountId})">
                        <div class="form-group">
                            <label for="firstName">–ò–º—è:</label>
                            <input type="text" id="firstName" name="firstName" maxlength="64" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">–§–∞–º–∏–ª–∏—è:</label>
                            <input type="text" id="lastName" name="lastName" maxlength="64">
                        </div>
                        <div class="form-group">
                            <label for="bio">–û —Å–µ–±–µ:</label>
                            <textarea id="bio" name="bio" maxlength="70" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="profilePhoto">–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è:</label>
                            <input type="file" id="profilePhoto" name="profilePhoto" accept="image/*">
                        </div>
                        <div class="form-buttons">
                            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button type="button" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(modal);

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
        }

        function closeModal() {
            const modal = document.querySelector('.modal');
            if (modal) {
                modal.remove();
            }
        }

        async function submitProfileEdit(event, accountId) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            try {
                const response = await fetch(`/api/accounts/${accountId}/update_profile`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.status === 'success') {
                    showMessage('–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
                    closeModal();
                    loadAccounts(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
                } else {
                    showMessage(result.message || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showMessage('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è', 'error');
            }
        }

        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;

            document.body.appendChild(messageDiv);

            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>