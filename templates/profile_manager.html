
{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ - Telegram Mass Sender{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è–º–∏</h1>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º -->
            <ul class="nav nav-tabs mb-4" id="profileTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="profiles-tab" data-bs-toggle="tab" data-bs-target="#profiles-pane" type="button" role="tab">
                        <i class="fas fa-user-edit me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="comments-tab" data-bs-toggle="tab" data-bs-target="#comments-pane" type="button" role="tab">
                        <i class="fas fa-comments me-2"></i>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="reactions-tab" data-bs-toggle="tab" data-bs-target="#reactions-pane" type="button" role="tab">
                        <i class="fas fa-heart me-2"></i>–†–µ–∞–∫—Ü–∏–∏
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="views-tab" data-bs-toggle="tab" data-bs-target="#views-pane" type="button" role="tab">
                        <i class="fas fa-eye me-2"></i>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã
                    </button>
                </li>
            </ul>

            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ -->
            <div class="tab-content" id="profileTabContent">
                <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π -->
                <div class="tab-pane fade show active" id="profiles-pane" role="tabpanel">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-file-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–º–µ–Ω–∞ –∏ —Ñ–∞–º–∏–ª–∏–∏</h5>
                                </div>
                                <div class="card-body">
                                    <form id="uploadNamesForm" enctype="multipart/form-data">
                                        <div class="mb-3">
                                            <label for="firstNamesFile" class="form-label">–§–∞–π–ª —Å –∏–º–µ–Ω–∞–º–∏ (firstname.txt)</label>
                                            <input type="file" class="form-control" id="firstNamesFile" accept=".txt">
                                        </div>
                                        <div class="mb-3">
                                            <label for="lastNamesFile" class="form-label">–§–∞–π–ª —Å —Ñ–∞–º–∏–ª–∏—è–º–∏ (lastname.txt)</label>
                                            <input type="file" class="form-control" id="lastNamesFile" accept=".txt">
                                        </div>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-random me-2"></i>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ</h5>
                                </div>
                                <div class="card-body">
                                    <button class="btn btn-success" onclick="autoAssignGenders()">
                                        <i class="fas fa-magic me-2"></i>–ù–∞–∑–Ω–∞—á–∏—Ç—å –≥–µ–Ω–¥–µ—Ä—ã –∏ –∏–º–µ–Ω–∞
                                    </button>
                                    <p class="text-muted mt-2">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∏—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –∏–º–µ–Ω–∞ –∏ —Ñ–∞–º–∏–ª–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º –ø–æ –∏—Ö –≥–µ–Ω–¥–µ—Ä—É</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-users me-2"></i>–ê–∫–∫–∞—É–Ω—Ç—ã</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                            <th>–ò–º—è</th>
                                            <th>–§–∞–º–∏–ª–∏—è</th>
                                            <th>–ì–µ–Ω–¥–µ—Ä</th>
                                            <th>Bio</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="accountsTableBody">
                                        {% for account in accounts %}
                                        <tr>
                                            <td>{{ account.id }}</td>
                                            <td>{{ account.phone }}</td>
                                            <td>
                                                <input type="text" class="form-control form-control-sm" 
                                                       value="{{ account.first_name or '' }}" 
                                                       onchange="updateAccountField({{ account.id }}, 'first_name', this.value)">
                                            </td>
                                            <td>
                                                <input type="text" class="form-control form-control-sm" 
                                                       value="{{ account.last_name or '' }}" 
                                                       onchange="updateAccountField({{ account.id }}, 'last_name', this.value)">
                                            </td>
                                            <td>
                                                <select class="form-select form-select-sm" 
                                                        onchange="updateAccountField({{ account.id }}, 'gender', this.value)">
                                                    <option value="">–ù–µ —É–∫–∞–∑–∞–Ω</option>
                                                    <option value="male" {% if account.gender == 'male' %}selected{% endif %}>–ú—É–∂—Å–∫–æ–π</option>
                                                    <option value="female" {% if account.gender == 'female' %}selected{% endif %}>–ñ–µ–Ω—Å–∫–∏–π</option>
                                                </select>
                                            </td>
                                            <td>
                                                <textarea class="form-control form-control-sm" rows="2" 
                                                          onchange="updateAccountField({{ account.id }}, 'bio', this.value)">{{ account.bio or '' }}</textarea>
                                            </td>
                                            <td>
                                                <button class="btn btn-sm btn-primary" onclick="editProfile({{ account.id }})">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-sm btn-success" onclick="updateProfile({{ account.id }})">
                                                    <i class="fas fa-sync"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
                <div class="tab-pane fade" id="comments-pane" role="tabpanel">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-comment-alt me-2"></i>–°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h5>
                                </div>
                                <div class="card-body">
                                    <form id="commentCampaignForm">
                                        <div class="mb-3">
                                            <label for="campaignName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏</label>
                                            <input type="text" class="form-control" id="campaignName" required>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="postUrl" class="form-label">URL –ø–æ—Å—Ç–∞</label>
                                            <input type="url" class="form-control" id="postUrl" 
                                                   placeholder="https://t.me/channel/message_id" required>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="maleComments" class="form-label">–ú—É–∂—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>
                                                    <textarea class="form-control" id="maleComments" rows="10" 
                                                              placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π 1&#10;–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π 2&#10;–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π 3"></textarea>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="femaleComments" class="form-label">–ñ–µ–Ω—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>
                                                    <textarea class="form-control" id="femaleComments" rows="10" 
                                                              placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π 1&#10;–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π 2&#10;–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π 3"></textarea>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="commentDelay" class="form-label">–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ (—Å–µ–∫—É–Ω–¥—ã)</label>
                                            <input type="number" class="form-control" id="commentDelay" value="60" min="1">
                                        </div>

                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-play me-2"></i>–°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-list me-2"></i>–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏</h5>
                                </div>
                                <div class="card-body">
                                    <div id="commentCampaignsList">
                                        <!-- –ë—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ —á–µ—Ä–µ–∑ AJAX -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–∞–∫—Ü–∏–π -->
                <div class="tab-pane fade" id="reactions-pane" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-thumbs-up me-2"></i>–ö–∞–º–ø–∞–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–π</h5>
                        </div>
                        <div class="card-body">
                            <form id="reactionCampaignForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="reactionCampaignName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏</label>
                                            <input type="text" class="form-control" id="reactionCampaignName" required>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="reactionPostUrl" class="form-label">URL –ø–æ—Å—Ç–∞</label>
                                            <input type="url" class="form-control" id="reactionPostUrl" required>
                                        </div>

                                        <div class="mb-3">
                                            <label for="reactionEmoji" class="form-label">–†–µ–∞–∫—Ü–∏—è</label>
                                            <select class="form-select" id="reactionEmoji" required>
                                                <option value="üëç">üëç –õ–∞–π–∫</option>
                                                <option value="‚ù§Ô∏è">‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ</option>
                                                <option value="üî•">üî• –û–≥–æ–Ω—å</option>
                                                <option value="ü•∞">ü•∞ –í–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç—å</option>
                                                <option value="üëé">üëé –î–∏–∑–ª–∞–π–∫</option>
                                                <option value="üò¢">üò¢ –ì—Ä—É—Å—Ç—å</option>
                                                <option value="üò°">üò° –ó–ª–æ—Å—Ç—å</option>
                                            </select>
                                        </div>

                                        <div class="mb-3">
                                            <label for="reactionDelay" class="form-label">–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Ä–µ–∞–∫—Ü–∏—è–º–∏ (—Å–µ–∫—É–Ω–¥—ã)</label>
                                            <input type="number" class="form-control" id="reactionDelay" value="30" min="1">
                                        </div>

                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-play me-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é —Ä–µ–∞–∫—Ü–∏–π
                                        </button>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="alert alert-info">
                                            <h6><i class="fas fa-info-circle me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
                                            <p>–ö–∞–º–ø–∞–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã –∏ –ø–æ—Å—Ç–∞–≤–∏—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –ø–æ—Å—Ç —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏.</p>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ -->
                <div class="tab-pane fade" id="views-pane" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-eye me-2"></i>–ö–∞–º–ø–∞–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</h5>
                        </div>
                        <div class="card-body">
                            <form id="viewCampaignForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="viewCampaignName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏</label>
                                            <input type="text" class="form-control" id="viewCampaignName" required>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="viewPostUrl" class="form-label">URL –ø–æ—Å—Ç–∞</label>
                                            <input type="url" class="form-control" id="viewPostUrl" required>
                                        </div>

                                        <div class="mb-3">
                                            <label for="viewDelay" class="form-label">–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)</label>
                                            <input type="number" class="form-control" id="viewDelay" value="10" min="1">
                                        </div>

                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-play me-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
                                        </button>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="alert alert-info">
                                            <h6><i class="fas fa-info-circle me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
                                            <p>–ö–∞–º–ø–∞–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –ø–æ–º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –ø–æ—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è –≤–∞—à–∏ –∞–∫–∫–∞—É–Ω—Ç—ã.</p>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞
async function updateAccountField(accountId, field, value) {
    try {
        const response = await fetch(`/api/accounts/${accountId}/update_field`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                field: field,
                value: value
            })
        });

        const result = await response.json();
        if (!result.success) {
            alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ' + result.message);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥–µ–Ω–¥–µ—Ä–æ–≤ –∏ –∏–º–µ–Ω
async function autoAssignGenders() {
    try {
        const response = await fetch('/api/accounts/auto_assign_genders', {
            method: 'POST'
        });

        const result = await response.json();
        if (result.success) {
            alert('–ì–µ–Ω–¥–µ—Ä—ã –∏ –∏–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã!');
            location.reload();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + result.message);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ Telegram
async function updateProfile(accountId) {
    try {
        const response = await fetch(`/api/accounts/${accountId}/update_telegram_profile`, {
            method: 'POST'
        });

        const result = await response.json();
        if (result.success) {
            alert('–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω –≤ Telegram!');
        } else {
            alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: ' + result.message);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
document.getElementById('commentCampaignForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = {
        name: document.getElementById('campaignName').value,
        post_url: document.getElementById('postUrl').value,
        male_comments: document.getElementById('maleComments').value,
        female_comments: document.getElementById('femaleComments').value,
        delay_seconds: parseInt(document.getElementById('commentDelay').value)
    };

    try {
        const response = await fetch('/api/comment_campaigns', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });

        const result = await response.json();
        if (result.success) {
            alert('–ö–∞–º–ø–∞–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞!');
            this.reset();
            loadCommentCampaigns();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + result.message);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
});

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ —Ä–µ–∞–∫—Ü–∏–π
document.getElementById('reactionCampaignForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = {
        name: document.getElementById('reactionCampaignName').value,
        post_url: document.getElementById('reactionPostUrl').value,
        reaction_emoji: document.getElementById('reactionEmoji').value,
        delay_seconds: parseInt(document.getElementById('reactionDelay').value)
    };

    try {
        const response = await fetch('/api/reaction_campaigns', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });

        const result = await response.json();
        if (result.success) {
            alert('–ö–∞–º–ø–∞–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–π –∑–∞–ø—É—â–µ–Ω–∞!');
            this.reset();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + result.message);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
});

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
document.getElementById('viewCampaignForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = {
        name: document.getElementById('viewCampaignName').value,
        post_url: document.getElementById('viewPostUrl').value,
        delay_seconds: parseInt(document.getElementById('viewDelay').value)
    };

    try {
        const response = await fetch('/api/view_campaigns', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });

        const result = await response.json();
        if (result.success) {
            alert('–ö–∞–º–ø–∞–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –∑–∞–ø—É—â–µ–Ω–∞!');
            this.reset();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + result.message);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
});

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–∞–º–ø–∞–Ω–∏–π –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
async function loadCommentCampaigns() {
    try {
        const response = await fetch('/api/comment_campaigns');
        const result = await response.json();
        
        const container = document.getElementById('commentCampaignsList');
        container.innerHTML = '';
        
        result.campaigns.forEach(campaign => {
            const campaignDiv = document.createElement('div');
            campaignDiv.className = 'mb-3 p-3 border rounded';
            campaignDiv.innerHTML = `
                <h6>${campaign.name}</h6>
                <p class="small text-muted">${campaign.post_url}</p>
                <span class="badge bg-${campaign.status === 'running' ? 'success' : 'secondary'}">${campaign.status}</span>
                ${campaign.status === 'created' ? 
                    `<button class="btn btn-sm btn-primary ms-2" onclick="startCommentCampaign(${campaign.id})">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>` : 
                    ''}
                ${campaign.status === 'running' ? 
                    `<button class="btn btn-sm btn-danger ms-2" onclick="stopCommentCampaign(${campaign.id})">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>` : 
                    ''}
            `;
            container.appendChild(campaignDiv);
        });
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–º–ø–∞–Ω–∏–π:', error);
    }
}

// –ó–∞–ø—É—Å–∫ –∫–∞–º–ø–∞–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
async function startCommentCampaign(campaignId) {
    try {
        const response = await fetch(`/api/comment_campaigns/${campaignId}/start`, {
            method: 'POST'
        });

        const result = await response.json();
        if (result.success) {
            alert('–ö–∞–º–ø–∞–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–∞!');
            loadCommentCampaigns();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + result.message);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–º–ø–∞–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
async function stopCommentCampaign(campaignId) {
    try {
        const response = await fetch(`/api/comment_campaigns/${campaignId}/stop`, {
            method: 'POST'
        });

        const result = await response.json();
        if (result.success) {
            alert('–ö–∞–º–ø–∞–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!');
            loadCommentCampaigns();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + result.message);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–º–ø–∞–Ω–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    loadCommentCampaigns();
});
</script>
{% endblock %}
